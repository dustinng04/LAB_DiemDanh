<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Schedule</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <span class="text-danger font-weight-bold">YEAR</span>
            <select id="yearSelect" class="custom-select d-inline-block" style="width: auto;">
                <option selected>2024</option>
                <!-- Add more years as needed -->
            </select>
        </div>
        <div>
            <span class="text-danger font-weight-bold">WEEK</span>
            <select id="weekSelect" class="custom-select d-inline-block" style="width: auto;">
                <option selected>2024-05-13</option>
                <!-- Add more weeks as needed -->
            </select>
        </div>
    </div>

    <table id="scheduleTable" class="table table-bordered text-center">
        <thead class="thead-light">
        <tr>
            <th></th>
            <th>MON<br>13/05</th>
            <th>TUE<br>14/05</th>
            <th>WED<br>15/05</th>
            <th>THU<br>16/05</th>
            <th>FRI<br>17/05</th>
            <th>SAT<br>18/05</th>
            <th>SUN<br>19/05</th>
        </tr>
        </thead>
        <tbody>
        <!-- Rows will be added dynamically via JavaScript -->
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function() {
        function fetchSchedule() {
            var startDate = $('#weekSelect').val();
            $.getJSON('/api/schedule', {startDate: startDate}, function(data) {
                var scheduleMap = {};
                data.forEach(function(course) {
                    var key = course.slot + '-' + new Date(course.startTime).getDate();
                    if (!scheduleMap[key]) {
                        scheduleMap[key] = [];
                    }
                    scheduleMap[key].push(course);
                });
                renderSchedule(scheduleMap);
            });
        }

        function renderSchedule(scheduleMap) {
            var $tbody = $('#scheduleTable tbody');
            $tbody.empty();

            for (var slot = 0; slot <= 4; slot++) {
                var $row = $('<tr/>');
                $row.append('<th scope="row">Slot ' + slot + '</th>');
                for (var day = 13; day <= 19; day++) {
                    var key = slot + '-' + day;
                    var $cell = $('<td/>');
                    if (scheduleMap[key]) {
                        scheduleMap[key].forEach(function(course) {
                            var courseInfo = '<div><strong>' + course.subjectId + '</strong> at ' + course.room + '<br>';
                            courseInfo += '<a href="#" class="badge badge-primary">View Materials</a><br>';
                            courseInfo += '<span class="badge ' + (course.type == 'Online' ? 'badge-success' : 'badge-danger') + '">' + course.type + '</span><br>';
                            courseInfo += '<span class="text-success">' + new Date(course.startTime).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'}) + ' - ' + new Date(course.endTime).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'}) + '</span></div>';
                            $cell.append(courseInfo);
                        });
                    } else {
                        $cell.text('-');
                    }
                    $row.append($cell);
                }
                $tbody.append($row);
            }
        }

        $('#yearSelect, #weekSelect').change(fetchSchedule);

        fetchSchedule(); // Initial fetch
    });
</script>
</body>
</html>
